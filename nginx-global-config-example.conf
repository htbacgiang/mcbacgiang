# File cấu hình toàn cục cho Nginx
# Thêm các dòng này vào /etc/nginx/nginx.conf trong block http {}
# Hoặc tạo file riêng trong /etc/nginx/conf.d/upload-config.conf

# ============================================
# File Upload Configuration (Global)
# ============================================
# Áp dụng cho tất cả sites nếu không được override ở server block

# Giới hạn kích thước upload (mặc định cho tất cả sites)
client_max_body_size 10M;

# Timeout cho request body
client_body_timeout 120s;
client_header_timeout 60s;

# Buffer size cho request body
client_body_buffer_size 512k;

# Số lượng buffer lớn cho header
large_client_header_buffers 4 16k;

# ============================================
# Rate Limiting Zones (Optional)
# ============================================
# Giới hạn số request từ một IP
limit_req_zone $binary_remote_addr zone=general_limit:10m rate=10r/s;
limit_req_zone $binary_remote_addr zone=upload_limit:10m rate=5r/m;

# ============================================
# Gzip Compression
# ============================================
gzip on;
gzip_vary on;
gzip_proxied any;
gzip_comp_level 6;
gzip_types text/plain text/css text/xml text/javascript 
           application/json application/javascript application/xml+rss 
           application/rss+xml font/truetype font/opentype 
           application/vnd.ms-fontobject image/svg+xml;

# ============================================
# Logging Format
# ============================================
log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                '$status $body_bytes_sent "$http_referer" '
                '"$http_user_agent" "$http_x_forwarded_for" '
                'rt=$request_time uct="$upstream_connect_time" '
                'uht="$upstream_header_time" urt="$upstream_response_time"';

# ============================================
# Connection Settings
# ============================================
keepalive_timeout 65;
keepalive_requests 100;
sendfile on;
tcp_nopush on;
tcp_nodelay on;











